<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kombi Sensor Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Courier New', Courier, monospace;
        }
        body {
            margin: 2rem;
            background-color: #222;
            color: white;
        }
        h1 {
            text-align: center;
            background: #EEEEEE;
            color: black;
            padding: .2em 1em;
            border-top: 3px solid #666666;
            border-bottom: 3px solid #999999;
        }
        h2 {
            text-align: left;
            padding: .2em 1em;
            border-top: 5px solid #666666;
            border-bottom: 1px solid #999999;
            font-size: 26px;
        }
        h3 {
            text-align: center;
            color: rgb(201, 33, 33);
            font-size: 28px;
        }
        h4 {
            text-align: justify;
            color: white;
            font-size: 18px;
        }
        #controls {
            margin-bottom: 1rem;
            text-align: center;
        }
        select {
            font-size: 16px;
        }
        #gallery img {
            max-width: 200px;
            margin: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            transition: transform 0.2s ease;
        }
        #gallery img:hover {
            transform: scale(1.05);
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
        }
        .info-button {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 32px;
            height: 32px;
            background-color: #218009;
            color: white;
            border-radius: 50%;
            text-align: center;
            font-weight: bold;
            font-size: 20px;
            border: none;
            line-height: 32px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            z-index: 1000;
        }
        .info-button:hover {
            background-color: #186306;
        }
        .modal_info {
            display: none;
            position: fixed;
            z-index: 999;
            left: 0; top: 0;
            width: 100%; height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
        }
        .modal_info-content {
            background-color: #f4f4f4;
            color: black;
            margin: 10% auto;
            padding: 20px;
            border-radius: 8px;
            width: 80%;
            max-width: 600px;
            position: relative;
        }
        .close_info {
            position: absolute;
            top: 10px; right: 15px;
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .close_info:hover {
            color: #000;
        }
        .btn-simular {
            background-color: #218009;
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        .btn-simular:hover {
            background-color: #1b6607;
        }
    </style>
    <link rel="icon" href="images/sensor_icon.png" />
</head>
<body>
    <h1>üöê Kombi Sensor Dashboard üöê</h1>

    <h2>$ OBJECTIVO</h2>
    <h3>Monitoramento em tempo real da Kombi Home</h3>
    <h4>Este painel exibe os dados coletados dos sensores instalados na Kombi Home ‚Äî incluindo o estado da porta, vibra√ß√£o do motor e localiza√ß√£o GPS.
        O objetivo √© acompanhar as leituras e testar a transmiss√£o em tempo real, tanto localmente quanto via nuvem.</h4>

    <h3>Leituras em Tempo Real</h3>
    <h4>Os gr√°ficos abaixo mostram a leitura atual de cada sensor. Voc√™ pode alternar entre eles e tamb√©m simular dados locais para testes.</h4>

    <div id="controls">
        <label for="sensorSelect" style="font-size: 20px;">Selecionar sensor: </label>
        <select id="sensorSelect">
            <option value="door">Sensor de Porta</option>
            <option value="vibration">Sensor de Vibra√ß√£o</option>
            <option value="gps">Sensor GPS</option>
        </select>
        <button class="btn-simular" id="simulateBtn">Simular Dados</button>
    </div>

    <canvas id="sensorChart" width="600" height="200"></canvas>

    <h2>$ AN√ÅLISE</h2>
    <h4>Ap√≥s as coletas reais, os dados ser√£o processados e analisados automaticamente. 
        Gr√°ficos comparativos e relat√≥rios de eventos (como aberturas de porta, vibra√ß√µes anormais ou desvios de rota) ser√£o exibidos aqui.</h4>

    <div style="position: relative;">
        <button id="infoBtn" class="info-button" title="Mais informa√ß√µes">?</button>
    </div>

    <div id="infoModal" class="modal_info">
        <div class="modal_info-content">
            <span class="close_info">&times;</span>
            <div id="modalText">Carregando...</div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
        const ctx = document.getElementById("sensorChart").getContext("2d");

        let chartInstance = new Chart(ctx, {
            type: "line",
            data: {
                labels: [],
                datasets: [{
                    label: "Leitura do Sensor",
                    data: [],
                    borderColor: "#218009",
                    borderWidth: 3,
                    fill: false,
                    tension: 0.1
                }]
            },
            options: {
                responsive: true,
                scales: {
                    x: {
                        ticks: { color: "white", font: { size: 14, weight: "bold" } },
                        grid: { color: "#444" }
                    },
                    y: {
                        beginAtZero: true,
                        ticks: { color: "white", font: { size: 14, weight: "bold" } },
                        grid: { color: "#444" }
                    }
                },
                plugins: {
                    legend: { labels: { color: "white", font: { size: 16 } } }
                }
            }
        });

        function simulateSensorData(sensorType) {
            let value;
            if (sensorType === "door") {
                value = Math.random() > 0.5 ? 1 : 0;
            } else if (sensorType === "vibration") {
                value = Math.random() * 5;
            } else if (sensorType === "gps") {
                value = 20 + Math.random() * 5;
            }
            return value;
        }

        function updateChart(sensorType) {
            const now = new Date().toLocaleTimeString();
            const newValue = simulateSensorData(sensorType);

            if (chartInstance.data.labels.length > 20) {
                chartInstance.data.labels.shift();
                chartInstance.data.datasets[0].data.shift();
            }

            chartInstance.data.labels.push(now);
            chartInstance.data.datasets[0].data.push(newValue);
            chartInstance.data.datasets[0].label = `Leitura do ${sensorType.toUpperCase()}`;
            chartInstance.update();
        }

        document.getElementById("simulateBtn").addEventListener("click", () => {
            const sensorType = document.getElementById("sensorSelect").value;
            setInterval(() => updateChart(sensorType), 1000);
        });

        // Modal info
        const modal_info = document.getElementById("infoModal");
        const btn = document.getElementById("infoBtn");
        const span = document.getElementsByClassName("close_info")[0];
        const modalText = document.getElementById("modalText");

        btn.onclick = () => {
            modal_info.style.display = "block";
            modalText.innerHTML = "Carregando informa√ß√µes...";
            fetchInfoContent();
        };

        span.onclick = () => { modal_info.style.display = "none"; };
        window.onclick = (event) => { if (event.target == modal_info) modal_info.style.display = "none"; };

        async function fetchInfoContent() {
            try {
                const res = await fetch("docs/info.md");
                const text = await res.text();
                modalText.innerHTML = marked.parse(text);
            } catch {
                modalText.innerHTML = "<p>Arquivo de informa√ß√µes n√£o encontrado.</p>";
            }
        }
    </script>
</body>
</html>
